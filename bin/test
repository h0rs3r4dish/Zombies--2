#!/usr/bin/ruby

testname = ARGV.first or 'all'

STDOUT.sync = true # Print after every p/print/puts, even without newlines

# Some helper functions
def test(text,&block)
	print text + '...'
	block.call
	puts "OK"
end
def assert(bool,message='')
	raise message if not bool
end


if testname == 'all' then
	$ignore = if File.exist? 'test/.ignore' then
			File.read('test/.ignore').split("\n")
		else
			Array.new
		end
	files = Dir['test/*']
	files.each { |file|
		next if $ignore.include? file
		puts "---- Running %s" % file
		load file		
		print "\n\n" unless file == files.last
	}
else
	load "test/%s.rb" % testname
end
